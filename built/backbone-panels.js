//     backbone-panels
//     (c) simonfan
//     backbone-panels is licensed under the MIT terms.

define("__backbone-panels/panel/parse-data",["require","exports","module","lodash"],function(e,n,t){var a=e("lodash"),i={x:{bbpMinLeft:"minLeft",bbpLeft:"left",bbpMaxLeft:"maxLeft",bbpMinWidth:"minWidth",bbpWidth:"width",bbpMaxWidth:"maxWidth",bbpDefaultWidth:"defaultWidth",bbpOpenWidth:"openWidth"},y:{bbpMinTop:"minTop",bbpTop:"top",bbpMaxTop:"maxTop",bbpMinHeight:"minHeight",bbpHeight:"height",bbpMaxHeight:"maxHeight"}};t.exports=function(){var e=this.$el.data(),n={};return a.each(i.x,function(t,a){n[t]=this.panels.evalMeasureX(e[a])},this),a.each(i.y,function(t,a){n[t]=this.panels.evalMeasureY(e[a])},this),n.elasticity=e.bbpElasticity,n.panelStatus=e.bbpStatus,n}}),define("__backbone-panels/panel/animations",["require","exports","module","lodash"],function(e,n){function t(){var e=this.panels.panelType(this);return"only"===e?!1:"tail"===e?"w":"e"}function a(){var e=this.panels.panelType(this);return"only"===e?!1:"tail"===e?"e":"w"}var i=e("lodash");n.bbpOpen=function(e,n){this.bbpEnablePanel();var t=parseInt(this.panels.evalMeasureX(this.modeld.get("openWidth"))),a=parseInt(this.modeld.get("width")),l=t-a;n=n||{};var s=n.complete;return n.complete=i.bind(function(){s&&s.apply(this.$el,arguments),i.isNumber(this._real_min_width_before_close_)&&(this.modeld.set("minWidth",this._real_min_width_before_close_),delete this._real_min_width_before_close_),this.panels.arrangePositions()},this),"w"===e?this.aExpandToW(l,n):this.aExpandToE(l,n)},n.bbpOpenToE=i.partial(n.bbpOpen,"e"),n.bbpOpenToW=i.partial(n.bbpOpen,"w"),n.openToE=n.bbpOpenToE,n.openToW=n.bbpOpenToW,n.bbpClose=function(e,n){n=n||{};var t=this.modeld,a=parseFloat(this.panels.evalMeasureX(t.get("closeWidth")))||0,l=parseFloat(t.get("width")),s=Math.abs(a-l),o=n.complete;return n.complete=i.bind(function(){o&&o.apply(this.$el,arguments),this.panels.arrangePositions()},this),this._real_min_width_before_close_=t.get("minWidth"),t.set("minWidth",a),"w"===e?this.aContractToW(s,n):this.aContractToE(s,n)},n.bbpCloseToE=i.partial(n.bbpClose,"e"),n.bbpCloseToW=i.partial(n.bbpClose,"w"),n.closeToE=n.bbpCloseToE,n.closeToW=n.bbpCloseToW,n.open=function(e){var n=this.modeld.get("openDirection")||t.call(this);return n?this.bbpOpen(n,e):n},n.close=function(e){var n=this.modeld.get("closeDirection")||a.call(this);return n?this.bbpClose(n,e):n}}),define("__backbone-panels/panel/enable-disable",["require","exports","module"],function(e,n){n._initializePanelEnableDisable=function(){this.listenTo(this.modeld,"change:panelStatus",function(){this.bbpPanelEnabled()?(this.enableResizable(),this.$el.addClass(this.panelClass+"-enabled").removeClass(this.panelClass+"-disabled")):(this.disableResizable(),this.$el.addClass(this.panelClass+"-disabled").removeClass(this.panelClass+"-enabled")),this.panels.arrangeBoundaries().arrangeHandles()})},n.bbpPanelEnabled=function(){return"enabled"===this.modeld.get("panelStatus")},n.bbpEnablePanel=function(){return this.modeld.set("panelStatus","enabled"),this},n.bbpDisablePanel=function(){return this.modeld.set("panelStatus","disabled"),this}}),define("__backbone-panels/panel/index",["require","exports","module","lodash","backbone-ui-resizable","lowercase-backbone","./parse-data","./animations","./enable-disable"],function(e,n,t){var a=e("lodash"),i=e("backbone-ui-resizable"),l=e("lowercase-backbone"),s=e("./parse-data"),o=t.exports=i.extend({initialize:function(e){l.view.prototype.initialize.call(this,e),this.initializeModelView(e),this.initializeUIDraggable(e),this.initializeUIResizable(e),this.initializePanel(e)},initializePanel:function(e){this.panels=e.panels,this.id=this.$el.prop("id");var n=s.call(this);a.defaults(n,this.bbpDefaults),this.modeld.set(n),this._initializePanelEnableDisable(),this.$el.addClass(this.panelClass),this.on("resizestart",function(){this.modeld.set("bbpPanelResizing",!0)},this),this.on("resizestop",function(){this.modeld.set("bbpPanelResizing",!1)},this)},bbpPanelResizing:function(){return this.modeld.get("bbpPanelResizing")},bbpDefaults:{panelStatus:"enabled",minWidth:"0",maxWidth:"100%",height:"100%"},handles:"w,e",panelClass:"panel"});o.proto(e("./animations")).proto(e("./enable-disable"))}),define("__backbone-panels/iterators",["require","exports","module","lodash"],function(e,n){var t=e("lodash"),a=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","findIndex","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample","partition"];t.each(a,function(e){n[e]=function(){var n=Array.prototype.slice.call(arguments);return n.unshift(this.panels),t[e].apply(t,n)}}),n.enabledPanels=function(){return this.filter(function(e){return e.bbpPanelEnabled()})},n.before=function(e){return this.first(e)},n.after=function(e){return this.rest(e+1)},n.reduceBefore=function(e,n,a,i){var l=this.before(e);return t.reduce(l,n,a,i)},n.reduceAfter=function(e,n,a,i){var l=this.after(e);return t.reduce(l,n,a,i)}}),define("__backbone-panels/arrange/position",["require","exports","module","lodash"],function(e,n,t){function a(e){return this.reduceBefore(e,function(e,n){return e+n.modeld.get("width")},0)}var i=e("lodash");t.exports=i.throttle(function(){return this.each(function(e,n){var t=a.call(this,n);e.modeld.set({left:t,top:0})},this),this},50)}),define("__backbone-panels/arrange/boundaries",["require","exports","module"],function(e,n,t){function a(e,n){return this.reduceBefore(n,function(n,t){return t.bbpPanelEnabled()?n+t.modeld.get(e):n+t.modeld.get("width")},0)}function i(e,n){var t=a.call(this,"maxWidth",n),i=a.call(this,"minWidth",n);e.modeld.set("maxLeft",t),e.modeld.set("minLeft",i)}function l(e,n){return this.reduceAfter(n,function(n,t){return t.bbpPanelEnabled()?n+t.modeld.get(e):n+t.modeld.get("width")},0)}function s(e,n){var t=l.call(this,"minWidth",n),a=l.call(this,"maxWidth",n),i=l.call(this,"width",-1);e.modeld.set("maxRight",i-t),e.modeld.set("minRight",i-a)}t.exports=function(){return this.each(function(e,n){i.call(this,e,n),s.call(this,e,n)},this),this}}),define("__backbone-panels/arrange/index",["require","exports","module","lodash","./position","./boundaries"],function(e,n){var t=e("lodash");n.arrangePositions=e("./position"),n.arrangeBoundaries=e("./boundaries"),n.arrangeHandles=function(){var e=this.filter(function(e){return e.bbpPanelEnabled()});return t.each(e,function(n,t){0===t?n.disableHandle("w").enableHandle("e"):t===e.length-1?n.disableHandle("e").enableHandle("w"):n.enableHandle("w").enableHandle("e")},this),this},n.arrange=function(){this.arrangePositions(),this.arrangeBoundaries(),this.arrangeHandles()}}),define("__backbone-panels/event-handlers",["require","exports","module","lodash"],function(e,n){e("lodash");n.handlePanelResize=function(e,n){if("panels-control"!==n.agent){var t,a,i=this.panelIndex(e),l=Math.abs(n.delta);n.panel=e,"expand"===n.action?"w"===n.handle?(t=this.before(i),this.contractPanelsToLeft(t,l,n)):"e"===n.handle&&(a=this.after(i),this.contractPanelsToRight(a,l,n)):"contract"===n.action&&("w"===n.handle?(t=this.before(i),this.expandPanelsToRight(t,l,n)):"e"===n.handle&&(a=this.after(i),this.expandPanelsToLeft(a,l,n)))}},n.handlePanelResizeStart=function(){},n.handlePanelResizeStop=function(){}}),define("__backbone-panels/controllers",["require","exports","module","lodash"],function(e,n){function t(e){return function(n,t,i){var l=this.controlOptions,s=a.clone(n);-1===e.loopDirection&&s.reverse();for(var o=[];s.length&&0!==t;){var r=s.pop();if(r.bbpPanelEnabled()&&!r.bbpPanelResizing())if(o.push(r),0===s.length)t=r[e.absorb](t,l);else{{var d=this.calcPanelElasticity({index:n.length-s.length-1,panel:r,panels:n,operation:e.operation,eventData:i}),h=t*d,p=t-h,b=r[e.absorb](h,l);r[e.move](p+b,l)}t-=h-b}else r[e.move](t,l)}if(t)for(;o.length>0&&0!==t;)t=o.pop()[e.absorb](t,l)}}var a=e("lodash");n.calcPanelElasticity=function(e){var n=parseFloat(e.panel.modeld.get("elasticity"));return isNaN(n)?this.controlOptions.elasticity:n},n.controlOptions={agent:"panels-control",elasticity:.3},n.contractPanelsToLeft=t({absorb:"contractToLeft",move:"moveToLeft",loopDirection:1,operation:"contract"}),n.contractPanelsToRight=t({absorb:"contractToRight",move:"moveToRight",loopDirection:-1,operation:"contract"}),n.expandPanelsToLeft=t({absorb:"expandToLeft",move:"moveToLeft",loopDirection:-1,operation:"expand"}),n.expandPanelsToRight=t({absorb:"expandToRight",move:"moveToRight",loopDirection:1,operation:"expand"})}),define("__backbone-panels/calculators",["require","exports","module"],function(e,n){var t=/[0-9.]+%/;n.evalMeasureX=function(e){if(t.test(e)){var n=1*parseFloat(e)/100;e=n*this.$el.width()}return e},n.evalMeasureY=function(e){if(t.test(e)){var n=1*parseFloat(e)/100;e=n*this.$el.height()}return e}}),define("__backbone-panels/enable-disable",["require","exports","module"],function(e,n){n.enablePanel=function(e){return this.getPanelById(e).enablePanel(),this},n.disablePanel=function(e){return this.getPanelById(e).disablePanel(),this},n.enablePanelAt=function(e){return this.getPanelAt(e).enablePanel(),this},n.disablePanelAt=function(e){return this.getPanelAt(e).disablePanel(),this}}),define("__backbone-panels/panel-meta-data",["require","exports","module","lodash"],function(e,n){var t=e("lodash");n.panelIndex=function(e){return this.findIndex(function(n){return n.cid===e.cid})},n.panelType=function(e){var n=this.enabledPanels();return 1===n.length?"only":e.id===n[0].id?"head":e.id===t.last(n).id?"tail":"middle"}}),define("backbone-panels",["require","exports","module","jquery","lowercase-backbone","lodash","./__backbone-panels/panel/index","./__backbone-panels/iterators","./__backbone-panels/arrange/index","./__backbone-panels/event-handlers","./__backbone-panels/controllers","./__backbone-panels/calculators","./__backbone-panels/enable-disable","./__backbone-panels/panel-meta-data"],function(e,n,t){var a=e("jquery"),i=e("lowercase-backbone"),l=e("lodash"),s=e("./__backbone-panels/panel/index"),o=t.exports=i.view.extend({initialize:function(e){i.view.prototype.initialize.call(this,e),this.initializePanels.call(this,e)},initializePanels:function(){l.bindAll(this,"handlePanelResize","handlePanelResizeStart","handlePanelResizeStop"),this.$el.css(this.css),this.panels=[],l.each(this.$el.children(),function(e,n){this.addPanel(n,{el:a(e)})},this),this.arrange()},panelBuilder:s,panelTemplate:"<div></div>",panelClass:"panel",addPanel:function(e,n){var t;if(n.el)t=n.el;else{var s=l.isFunction(this.panelTemplate)?this.panelTemplate(n):this.panelTemplate;t=a(s).appendTo(this.$el)}var o=this.panelBuilder(l.extend({},this.handleOptions,n,{el:t,model:i.model(),panels:this}));this.listenTo(o,"resizestart",this.handlePanelResizeStart).listenTo(o,"resize-x",this.handlePanelResize).listenTo(o,"resizestop",this.handlePanelResizeStop),this.listenTo(o.modeld,"change:minWidth change:maxWidth",this.arrangeBoundaries),this.panels.splice(e,1,o)},getPanelById:function(e){return this.find(function(n){return n.id===e})},getPanelAt:function(e){return this.panels[e]},css:{position:"relative"}});o.proto(e("./__backbone-panels/iterators")),o.proto(e("./__backbone-panels/arrange/index")),o.proto(e("./__backbone-panels/event-handlers")),o.proto(e("./__backbone-panels/controllers")),o.proto(e("./__backbone-panels/calculators")),o.proto(e("./__backbone-panels/enable-disable")),o.proto(e("./__backbone-panels/panel-meta-data")),o.panelBuilder=s});